<!DOCTYPE html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge"> -->
    <title>PetaBencana</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->

    <!-- CSS -->
    <link rel="stylesheet" href="css/frontpage/owl.carousel.css">
    <link rel="stylesheet" href="css/frontpage/bootstrap.min.css">
    <link rel="stylesheet" href="css/frontpage/font-awesome.min.css">
    <link rel="stylesheet" href="css/frontpage/style.css">
    <link rel="stylesheet" href="css/frontpage/ionicons.min.css">
    <link rel="stylesheet" href="css/frontpage/animate.css">
    <link rel="stylesheet" href="css/frontpage/responsive.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" />
    <link href='https://api.mapbox.com/mapbox-gl-js/v0.20.1/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.css" />

    <!-- Js -->
    <script src='https://api.mapbox.com/mapbox-gl-js/v0.20.1/mapbox-gl.js'></script>
    <script src="js/frontpage/vendor/modernizr-2.6.2.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/frontpage/vendor/jquery-1.10.2.min.js"><\/script>')</script>
    <script src="js/frontpage/bootstrap.min.js"></script>
    <script src="js/frontpage/plugins.js"></script>

    <script src="js/frontpage/jquery.counterup.js"></script>
    <script src="https://domoritz.github.io/leaflet-locatecontrol/dist/L.Control.Locate.min.js" charset="utf-8"></script>
    <!-- Google Map -->
    <script src="js/frontpage/main.js"></script>

  </head>
  <body>

<!-- Extra style elements for the reports-->
<style>  .marker {
          border: none;
          cursor: pointer;
          height: 56px;
          width: 56px;
          background-image: url("flood.png");
          background-color: rgba(0, 0, 0, 0);
          transform: translate(28px, 56px, 0);
        }
        </style>
    <!-- Header Start -->
  <header>
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <!-- header Nav Start -->
          <nav class="navbar navbar-default">
            <div class="container-fluid">
              <!-- Brand and toggle get grouped for better mobile display -->
              <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">
                  <img src="img/logo.png" alt="Logo">
                </a>
              </div>
                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                  <ul class="nav navbar-nav navbar-right">
                      <li><a href="index.html">Map</a>
                      <ul class="nav">
                          <li><a id='Jakarta' href="Jakarta.html">Jakarta</a></li>
                          <li><a id='Surabaya' href="Surabaya.html">Surabaya</a></li>
                          <li><a id='Bandung' href="Bandung.html">Bandung</a></li> </ul></li>
                      <li><a href="Watch.html">Watch</a></li>
                    <li><a href="About.html">About</a></li>
                  </ul>
                </div><!-- /.navbar-collapse -->
              </div><!-- /.container-fluid -->
            </nav>
          </div>
        </div>
      </div>
    </header><!-- header close -->

    <!-- Map Start-->

<div id='MapContain'></div>
    <script>

    var bounds = [
        [106.43,-6.65], // Southwest coordinates
        [107.23,-5.85]  // Northeast coordinates
    ];


mapboxgl.accessToken = 'pk.eyJ1IjoiYXNiYXJ2ZSIsImEiOiI4c2ZpNzhVIn0.A1lSinnWsqr7oCUo0UMT7w';
var map = new mapboxgl.Map({
    container: 'MapContain', // container id
    style: 'mapbox://styles/asbarve/ciu0anscx00ac2ipgyvuieuu9', //stylesheet location
    center: [106.83, -6.25], // starting position
    zoom: 10, // starting zoom
    attributionControl: false,
    maxZoom: 15,
    minZoom: 5,
    maxBounds: bounds // Sets bounds as max
})

// Add geolocation to the map.
var geolocate = new mapboxgl.Geolocate({position: 'top-left'});
map.addControl(geolocate);

// Add zoom and rotation controls to the map.
map.addControl(new mapboxgl.Navigation());

//var url = 'https://raw.githubusercontent.com/ojha-url/URL_Internal/master/Test_jakarta.json';
//var url = 'https://raw.githubusercontent.com/urbanriskmap/cognicity-grasp/mvp-cards/mocks/mockReports.json';

var response;
$.get('/reports/confirmed/', {}, function (response) {
  console.log('Get All Reports successful');
});

map.on('load', function () {
    window.setInterval(function() {
        map.getSource('report').setData(response); //Not sure why same thing is happening in two files 
    }, 2000);

    map.addSource('report', { type: 'geojson', data: response });

    map.addLayer({
        "id": "report",
        "type": "symbol",
        "source": "report",
        "layout": {
        "icon-image": "circle-15"
      }

    });

});


//popup
map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['report'] });
        var feature = features[0];

    // Populate the popup and set its coordinates
    // based on the feature found.
    var popup = new mapboxgl.Popup()
        .setLngLat(feature.geometry.coordinates)
        .setHTML('<b>Live Report<br> Source: </b>' + feature.properties.source +'<b><br>Status:</b> '+ feature.properties.status)
        .addTo(map);
});


// Use the same approach as above to indicate that the symbols are clickable
// by changing the cursor style to 'pointer'.
map.on('mousemove', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['report'] });
    map.getCanvas().style.cursor = (features.length) ? 'pointer' : '';
});



//listner for Links to the city specific pages.
// Jakarta
//document.getElementById('Jakarta').addEventListener('click', function () {
//     window.location.href = "Jakarta.html"
//});

// Surabaya
//document.getElementById('Surabaya').addEventListener('click', function () {
//     window.location.href = "Surabaya.html"
//});
// Bandung
//document.getElementById('Bandung').addEventListener('click', function () {
//     window.location.href = "Bandung.html"
//});
</script>

  <!-- footer Start -->
    <footer>
      <div class="container">
        <div class="row">
          <div class="col-md-12">
            <p>Copyright &copy; <a href="https://www.urbanrisklab.org/">UrbanRiskLab</a>.</p>
          </div>
        </div>
      </div>
    </footer>
    </body>
</html>
